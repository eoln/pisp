<svg xmlns="http://www.w3.org/2000/svg" height="1455" preserveAspectRatio="none" style="width:1652px;height:1455px" width="1652">
  <defs>
    <filter height="300%" id="a" width="300%" x="-1" y="-1">
      <feGaussianBlur result="blurOut" stdDeviation="2"/>
      <feColorMatrix in="blurOut" result="blurOut2" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/>
      <feOffset dx="4" dy="4" in="blurOut2" result="blurOut3"/>
      <feBlend in="SourceGraphic" in2="blurOut3"/>
    </filter>
  </defs>
  <text font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="323" x="667" y="28.708">
    PISP Linking: Request consent (OTP)
  </text>
  <path fill="#DDD" stroke="#a80036" d="M630.5 40.953h73v1408.758h-73z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="67" x="633.5" y="53.02">
    Mojaloop
  </text>
  <path fill="#FFF" filter="url(#a)" stroke="#fff" d="M24 105.383h10v67.133H24z"/>
  <path stroke="#a80036" d="M24 105.383v67.133M34 105.383v67.133M24 105.383h10"/>
  <path fill="#FFF" filter="url(#a)" stroke="#fff" d="M24 200.516h10v246.992H24z"/>
  <path stroke="#a80036" d="M24 200.516v246.992M34 200.516v246.992M24 447.508h10"/>
  <path fill="#FFF" filter="url(#a)" stroke="#a80036" d="M24 1325.148h10v77.266H24zM662 418.375h10V702.5h-10zM662 1031.023h10v323.258h-10zM1300 673.367h10v386.789h-10z"/>
  <path stroke="#a80036" d="M29 95.383v10"/>
  <path stroke="#a80036" stroke-dasharray="1,4" d="M29 105.383v28"/>
  <path stroke="#a80036" d="M29 133.383v39.133"/>
  <path stroke="#a80036" stroke-dasharray="1,4" d="M29 172.516v28"/>
  <path stroke="#a80036" d="M29 200.516v1210.898M666.5 95.383v10"/>
  <path stroke="#a80036" stroke-dasharray="1,4" d="M666.5 105.383v28"/>
  <path stroke="#a80036" d="M666.5 133.383v39.133"/>
  <path stroke="#a80036" stroke-dasharray="1,4" d="M666.5 172.516v28"/>
  <path stroke="#a80036" d="M666.5 200.516v1210.898M1304.5 95.383v10"/>
  <path stroke="#a80036" stroke-dasharray="1,4" d="M1304.5 105.383v28"/>
  <path stroke="#a80036" d="M1304.5 133.383v39.133"/>
  <path stroke="#a80036" stroke-dasharray="1,4" d="M1304.5 172.516v28"/>
  <path stroke="#a80036" d="M1304.5 200.516v1210.898"/>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M5 60.086h44v30.297H5z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="12" y="80.081">
    PISP
  </text>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M5 1410.414h44v30.297H5z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="12" y="1430.409">
    PISP
  </text>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M635.5 60.086h59v30.297h-59z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="642.5" y="80.081">
    Switch
  </text>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M635.5 1410.414h59v30.297h-59z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="642.5" y="1430.409">
    Switch
  </text>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M1277.5 60.086h51v30.297h-51z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="1284.5" y="80.081">
    DFSP
  </text>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M1277.5 1410.414h51v30.297h-51z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="1284.5" y="1430.409">
    DFSP
  </text>
  <path fill="#FFF" filter="url(#a)" stroke="#fff" d="M24 105.383h10v67.133H24z"/>
  <path stroke="#a80036" d="M24 105.383v67.133M34 105.383v67.133M24 105.383h10"/>
  <path fill="#FFF" filter="url(#a)" stroke="#fff" d="M24 200.516h10v246.992H24z"/>
  <path stroke="#a80036" d="M24 200.516v246.992M34 200.516v246.992M24 447.508h10"/>
  <path fill="#FFF" filter="url(#a)" stroke="#a80036" d="M24 1325.148h10v77.266H24zM662 418.375h10V702.5h-10zM662 1031.023h10v323.258h-10zM1300 673.367h10v386.789h-10z"/>
  <path d="M5 138.383v25h1322v-15l-10-10H5" fill="#FBFB77" filter="url(#a)" stroke="#a80036"/>
  <path d="M1317 138.383v10h10l-10-10" fill="#FBFB77" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="783" x="268.25" y="155.45">
    The user initiated some sort of account linking by choosing the appropriate DFSP from a screen inside the PISP application.
  </text>
  <path fill="#A80036" stroke="#a80036" d="M650 414.375l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M34 418.375h622"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="44" x="41" y="314.946">
    REQ-1
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="89" y="216.583">
    POST /consentRequests
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="113" y="231.715">
    FSIOP-Source: pispa
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="113" y="246.848">
    FSIOP-Destination: dfspa
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="89" y="261.981">
    {
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="113" y="277.114">
    consentRequestId: &quot;456&quot;,
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="113" y="292.247">
    scopes: [
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="129" y="307.379">
    {
  </text>
  <text font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="424" x="145" y="307.379">
    accountId: &quot;dfsp.username.1234&quot;, // Required for OTP!
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="145" y="322.512">
    actions: [ &quot;accounts.transfer&quot;, &quot;accounts.getBalance&quot; ] },
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="129" y="337.645">
    { accountId: &quot;dfsp.username.5678&quot;,
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="145" y="352.778">
    actions: [ &quot;accounts.transfer&quot;, &quot;accounts.getBalance&quot; ] },
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="113" y="367.911">
    ],
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="113" y="383.043">
    authChannels: [ &quot;Web&quot;, &quot;OTP&quot; ],
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="113" y="398.176">
    callbackUri: &quot;pisp-app://callback...
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="401" y="398.176">
    &quot;
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="97" y="413.309">
    }
  </text>
  <path fill="#A80036" stroke="#a80036" d="M40 443.508l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M34 447.508h627"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="44" x="46" y="442.442">
    REQ-2
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="94" y="442.442">
    202 Accepted
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1288 669.367l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M672 673.367h622"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="44" x="679" y="569.938">
    REQ-3
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="727" y="471.575">
    POST /consentRequests
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="751" y="486.707">
    FSIOP-Source: pispa
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="751" y="501.84">
    FSIOP-Destination: dfspa
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="727" y="516.973">
    {
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="751" y="532.106">
    consentRequestId: &quot;456&quot;,
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="751" y="547.239">
    scopes: [
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="767" y="562.372">
    {
  </text>
  <text font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="424" x="783" y="562.372">
    accountId: &quot;dfsp.username.1234&quot;, // Required for OTP!
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="783" y="577.504">
    actions: [ &quot;accounts.transfer&quot;, &quot;accounts.getBalance&quot; ] },
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="767" y="592.637">
    { accountId: &quot;dfsp.username.5678&quot;,
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="783" y="607.77">
    actions: [ &quot;accounts.transfer&quot;, &quot;accounts.getBalance&quot; ] },
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="751" y="622.903">
    ],
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="751" y="638.036">
    authChannels: [ &quot;Web&quot;, &quot;OTP&quot; ],
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="751" y="653.168">
    callbackUri: &quot;pisp-app://callback...
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="1039" y="653.168">
    &quot;
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="735" y="668.301">
    }
  </text>
  <path fill="#A80036" stroke="#a80036" d="M678 698.5l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M672 702.5h627"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="44" x="684" y="697.434">
    REQ-4
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="732" y="697.434">
    202 Accepted
  </text>
  <path stroke="#a80036" d="M1310 792.164h42M1352 792.164v13M1311 805.164h41"/>
  <path fill="#A80036" stroke="#a80036" d="M1321 801.164l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="44" x="1317" y="756.832">
    REQ-5
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="1365" y="726.567">
    POST /sendOTP
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="1373" y="741.7">
    {
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="1389" y="756.832">
    consentRequestId: &quot;456&quot;,
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="1389" y="771.965">
    accountId: &quot;dfsp.username.5678&quot;
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="1373" y="787.098">
    }
  </text>
  <path fill="#A80036" stroke="#a80036" d="M683 1027.023l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" d="M677 1031.023h622"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="44" x="689" y="927.594">
    REQ-6
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="737" y="829.231">
    PUT /consentRequests/456
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="761" y="844.364">
    FSIOP-Source: dfspa
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="761" y="859.497">
    FSIOP-Destination: pispa
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="745" y="874.629">
    {
  </text>
  <text font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="536" x="761" y="889.762">
    authChannels: [ &quot;OTP&quot; ], // This is updated with the channel in use
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="761" y="904.895">
    scopes: [
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="777" y="920.028">
    { accountId: &quot;dfsp.username.1234&quot;,
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="793" y="935.161">
    actions: [ &quot;accounts.transfer&quot;, &quot;accounts.getBalance&quot; ] },
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="777" y="950.293">
    { accountId: &quot;dfsp.username.5678&quot;,
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="793" y="965.426">
    actions: [ &quot;accounts.transfer&quot;, &quot;accounts.getBalance&quot; ] },
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="761" y="980.559">
    ],
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="761" y="995.692">
    callbackUri: &quot;pisp-app://callback...
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="1049" y="995.692">
    &quot;
  </text>
  <text font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="248" x="761" y="1010.825">
    //note: no authUri for OTP flow
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="745" y="1025.957">
    }
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1293 1056.156l10 4-10 4 4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M672 1060.156h627"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="44" x="679" y="1055.09">
    REQ-7
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="727" y="1055.09">
    202 Accepted
  </text>
  <path d="M5 1073.156v25h1322v-15l-10-10H5" fill="#FBFB77" filter="url(#a)" stroke="#a80036"/>
  <path d="M1317 1073.156v10h10l-10-10" fill="#FBFB77" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="414" x="452.75" y="1090.223">
    Here, the DFSP sends an OTP directly to the user (e.g., via SMS).
  </text>
  <path fill="#A80036" stroke="#a80036" d="M45 1321.148l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" d="M39 1325.148h622"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="44" x="51" y="1221.719">
    REQ-8
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="99" y="1123.356">
    PUT /consentRequests/456
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="123" y="1138.489">
    FSIOP-Source: dfspa
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="123" y="1153.622">
    FSIOP-Destination: pispa
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="99" y="1168.754">
    {
  </text>
  <text font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="536" x="123" y="1183.887">
    authChannels: [ &quot;OTP&quot; ], // This is updated with the channel in use
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="123" y="1199.02">
    scopes: [
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="139" y="1214.153">
    { accountId: &quot;dfsp.username.1234&quot;,
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="155" y="1229.286">
    actions: [ &quot;accounts.transfer&quot;, &quot;accounts.getBalance&quot; ] },
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="139" y="1244.418">
    { accountId: &quot;dfsp.username.5678&quot;,
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="464" x="155" y="1259.551">
    actions: [ &quot;accounts.transfer&quot;, &quot;accounts.getBalance&quot; ] },
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="123" y="1274.684">
    ],
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="123" y="1289.817">
    callbackUri: &quot;pisp-app://callback...
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="411" y="1289.817">
    &quot;
  </text>
  <text font-family="monospace" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="248" x="123" y="1304.95">
    //note: no authUri for OTP flow
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="107" y="1320.082">
    }
  </text>
  <path fill="#A80036" stroke="#a80036" d="M655 1350.281l10 4-10 4 4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M34 1354.281h627"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="44" x="41" y="1349.215">
    REQ-9
  </text>
  <text font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="89" y="1349.215">
    202 Accepted
  </text>
  <path d="M5 1367.281v25h1322v-15l-10-10H5" fill="#FBFB77" filter="url(#a)" stroke="#a80036"/>
  <path d="M1317 1367.281v10h10l-10-10" fill="#FBFB77" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="800" x="259.75" y="1384.348">
    At this point, the PISP knows that the OTP authChannel is in use and the PISP App should prompt the user to provide the OTP.
  </text>
</svg>
